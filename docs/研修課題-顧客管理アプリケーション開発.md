# 研修課題：顧客管理アプリケーション開発

## 1. 研修の目的

本研修は、新人ソフトウェアエンジニアがデスクトップアプリケーション開発における一連のプロセスを実践的に学ぶことを目的とします。特に、UI設計からデータベース連携までの流れを体系的に理解し、今後の開発業務の土台となるスキルを習得することを目指します。

  * **Windows Formsによる基本的なUI設計とイベント処理の実装**
  * **MySQLデータベースの設計と操作**
  * **Entity Framework (EF) を用いたデータベース連携（CRUD操作）**
  * **参照系画面と更新系画面の連携による、実践的なアプリケーション開発フローの理解**

-----

## 2. 課題概要

顧客情報を管理（登録、表示、更新、削除）するための、シンプルなデスクトップアプリケーションを開発します。この課題を通して、データがどのように画面に表示され、ユーザーの操作によってどのように永続化されるのか、その一連の流れを体験的に学習します。

-----

## 3. 学習目標

この課題を完了することで、以下のスキルを独力で遂行できるようになることを目指します。

  * ✅ 顧客一覧画面（参照系）を作成できる。
  * ✅ 顧客登録・編集画面（更新系）を作成できる。
  * ✅ Entity Frameworkを利用して、データベースから顧客情報を取得・表示できる。
  * ✅ Entity Frameworkを利用して、新しい顧客情報をデータベースに登録できる。
  * ✅ Entity Frameworkを利用して、既存の顧客情報を更新できる。
  * ✅ Entity Frameworkを利用して、顧客情報を削除できる。

-----

## 4. 技術スタック

開発には以下の技術を使用します。自身の環境に合わせてバージョンを選択してください。

  * **言語:** C#
  * **フレームワーク:** .NET Framework (4.7.2以降) or .NET 6 (or newer)
  * **UI:** Windows Forms
  * **データベース:** MySQL
  * **ORM:** Entity Framework 6 (or EF Core)

-----

## 5. 要件定義

これから作成するアプリケーションが満たすべき要件を以下に定義します。

### 5.1. データベース設計

まず、アプリケーションのデータを格納するためのデータベースとテーブルを準備します。

  * **データベース名:** `customer_management` （任意）
  * **テーブル名:** `customers`

**テーブルスキーマ**

```sql
CREATE TABLE customers (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    kana VARCHAR(255),
    phone_number VARCHAR(20),
    email VARCHAR(255) UNIQUE,
    created_at DATETIME,
    updated_at DATETIME
);
```

### 5.2. 画面仕様

アプリケーションは、主に「顧客一覧画面」と「顧客登録・編集画面」の2つの画面で構成されます。

#### a. 顧客一覧画面 (参照系)

アプリケーションのメイン画面です。顧客データの一覧表示と、各操作への起点となります。

  * **【R: Read】データ表示:** アプリケーション起動時に、`customers`テーブルの全データを取得し、**DataGridView**コントロールに一覧表示します。
      * **表示項目:** `ID`, `氏名`, `フリガナ`, `メールアドレス`
  * **【C: Create】新規登録:** 「**新規登録**」ボタンを配置します。クリックすると、**顧客登録・編集画面**を「新規モード」で開きます。
  * **【U: Update】編集:** 「**編集**」ボタンを配置します。一覧から特定の顧客を選択した状態でクリックすると、その顧客の情報を引き継いで**顧客登録・編集画面**を「編集モード」で開きます。
  * **【D: Delete】削除:** 「**削除**」ボタンを配置します。一覧から特定の顧客を選択した状態でクリックすると、「本当に削除しますか？」といった確認メッセージを表示します。承認されると、データベースから該当データを削除し、画面の一覧を最新の状態に更新します。

#### b. 顧客登録・編集画面 (更新系)

新規顧客の登録、または既存顧客の情報を編集するための画面です。

  * **入力項目:**
      * 氏名 (TextBox)
      * フリガナ (TextBox)
      * 電話番号 (TextBox)
      * メールアドレス (TextBox)
  * **ボタン:**
      * **登録/更新ボタン:**
          * **新規モード時:** ボタンのテキストを「**登録**」とします。クリックすると、入力内容でデータベースに新しい顧客データを登録し、この画面を閉じます。
          * **編集モード時:** ボタンのテキストを「**更新**」とします。クリックすると、入力内容でデータベースの該当顧客情報を更新し、この画面を閉じます。
      * **キャンセルボタン:** クリックすると、何も処理を行わずにこの画面を閉じます。

#### c. 画面共通仕様

  * **画面遷移:** 顧客登録・編集画面は、一覧画面から**モーダルダイアログ**として表示してください (`ShowDialog()`メソッドを使用)。これにより、子画面（登録・編集画面）を閉じないと親画面（一覧画面）が操作できないようになります。
  * **データ更新の反映:** 顧客の新規登録、情報更新、または削除を行った後、一覧画面の表示は**自動的に最新の状態に更新**されるようにしてください。これにより、操作結果が即座に画面に反映されます。

#### d. バリデーション要件の明確化

  * **必須項目:** **氏名**と**メールアドレス**は必須入力です。空のまま登録・更新はできません。
  * **形式チェック:** **電話番号の厳密な形式チェック**（ハイフンの有無など）は、本課題の必須要件には含みません。
  * **一意性制約:** **メールアドレスはシステム全体で一意**である必要があります。登録・更新時に、入力されたメールアドレスが既にデータベースに存在する場合、「このメールアドレスは既に使用されています。」といったエラーメッセージを表示し、処理を中断してください。

-----

## 6. 推奨実装ステップ (受講者へのヒント)

この課題を効率的に進めるために、以下のステップで実装することをお勧めします。一つ一つのステップを着実にクリアしていきましょう。

1.  **環境構築 🛠️**
      * MySQLをPCにインストールし、データベース（例: `customer_management`）と`customers`テーブルを上記スキーマ通りに作成します。
2.  **プロジェクト作成 🏗️**
      * Visual Studioを起動し、新しい「Windows Forms App (.NET Framework または .NET)」プロジェクトを作成します。
3.  **Entity Framework設定 🔗**
      * NuGetパッケージマネージャーから`EntityFramework`と`MySql.Data.EntityFramework`をインストールします。
      * **Database First**のアプローチで、作成した`customers`テーブルからモデル（エンティティクラス）とDbContextを自動生成します。
4.  **一覧画面作成 (Read) 📄**
      * `Form1.cs`（または任意の名前に変更）に`DataGridView`と各種ボタン（新規登録, 編集, 削除）を配置します。
      * フォームのロードイベントで、Entity Frameworkを使用して`customers`テーブルから全データを取得し、`DataGridView`にバインドするロジックを実装します。
5.  **登録・編集画面作成 📝**
      * 新しいフォーム (`CustomerEditForm.cs`など) をプロジェクトに追加します。
      * 入力用の`TextBox`と、「登録/更新」「キャンセル」ボタンを配置します。
6.  **画面間連携 ↔️**
      * 一覧画面の「新規登録」ボタンクリックで、登録・編集画面をモーダルで表示します。
      * 一覧画面の「編集」ボタンクリックで、選択されている顧客のIDを登録・編集画面に渡し、そのIDを元に顧客データを取得・表示する処理を実装します。
7.  **CRUD機能実装 ⚙️**
      * **登録機能 (Create):** 登録・編集画面で、入力された情報をもとに新しい顧客オブジェクトを作成し、DbContext経由でデータベースに保存します。
      * **更新機能 (Update):** 登録・編集画面で、取得済みの顧客オブジェクトのプロパティを更新し、DbContext経由でデータベースに保存します。
      * **削除機能 (Delete):** 一覧画面で、選択された顧客をDbContext経由でデータベースから削除します。
8.  **仕上げ ✨**
      * 登録・編集画面に必須項目の入力チェックを実装します。
      * 削除実行前の確認メッセージや、各処理完了後のフィードバック（例: 「登録が完了しました」）などを実装し、アプリケーションの使いやすさを向上させます。

-----

## 7. 成果物

  * **作成したアプリケーションのソースコード一式** (Visual Studioのソリューションフォルダごと)

-----

## 8. 評価基準

以下の観点で実装内容を確認します。

  * ✅ **要件充足度:** 要件定義で定められた全ての機能が、仕様通りに正しく動作するか。
  * ✅ **コード品質:**
      * 変数名、メソッド名、クラス名が処理内容を的確に表しているか。
      * コードが適切にインデントされ、読みやすいか。
      * ロジックが不必要に複雑になっていないか。
  * ✅ **エラー処理（発展）:** データベース接続に失敗した場合など、予期せぬエラーが発生した際にアプリケーションがクラッシュせず、適切に処理を終了できるか。

-----

## 9. 実装後のテスト

アプリケーションが要件通りに正しく、かつ安定して動作することを確認するため、ご自身でテストを実施してください。開発者自身がテストを行うことは品質を担保する上で非常に重要な工程です。

### 9.1. テスト観点

以下の観点を参考に、テスト項目を洗い出して実施してみましょう。

**✅ 正常系テスト（Happy Path）**

  * [C] 新規顧客を登録し、一覧画面に正しく追加されるか。
  * [R] アプリケーション起動時に、DB内の全顧客が正しく表示されるか。
  * [U] 既存の顧客情報を編集し、内容が正しく更新されているか。
  * [D] 既存の顧客を削除し、一覧から消えているか。
  * [連携] 編集後・登録後に一覧画面へ戻ると、変更が即時反映されているか。

**⚠️ 異常系テスト（Edge Cases）**

  * **入力値チェック:**
      * 必須項目（氏名、メールアドレス）を空欄にして登録・更新を実行した際に、適切なエラーメッセージが表示されるか。
      * 既に登録済みのメールアドレスで新規登録・更新を実行した際に、一意性制約違反のエラーメッセージが表示されるか。
  * **操作手順:**
      * 一覧で何も選択せずに「編集」や「削除」ボタンをクリックした場合、エラーメッセージが表示されるか、あるいはボタンが非活性になっているか。
  * **データ境界値:**
      * データベースのカラムで許容されている最大文字数ギリギリのデータを入力しても、エラーなく登録・表示できるか。

**🖥️ 画面操作テスト**

  * 登録・編集画面を開いている間、背景の一覧画面が操作できない状態（モーダル）になっているか。
  * 「キャンセル」ボタンをクリックした際に、データが保存されずに画面が閉じるか。

-----

## 10. 発展課題 (オプション)

基本課題が完了し、さらにスキルアップを目指す方は、以下の機能実装に挑戦してみてください。

  * **検索機能:** 一覧画面に検索用のテキストボックスを追加し、氏名やフリガナでの部分一致検索を実装する。
  * **日時の自動更新:** 登録時(`created_at`)、更新時(`updated_at`)に、現在日時を自動でセットするロジックを実装する (ヒント: `DbContext`の`SaveChanges`をオーバーライドする)。
  * **高度な入力チェック:** メールアドレスが正しい形式（例: `user@example.com`）であるかを正規表現などを用いてチェックする。
  * **ページング:** 顧客データが大量にある場合を想定し、一覧画面にページング機能（例: 20件ずつ表示）を実装する。

### セキュリティの考慮

実務ではアプリケーションのセキュリティを確保することが極めて重要です。以下の点について理解を深めましょう。

  * **SQLインジェクション対策**
      * **理解:** 本課題では**Entity Framework (EF)** を使用しています。EFのようなORM（Object-Relational Mapper）は、内部で**パラメータ化クエリ**を自動的に生成します。これにより、開発者が意識しなくても、不正なSQL文が組み立てられるのを防ぎ、**SQLインジェクションの脆弱性を原理的に防止**しています。この「ORMがセキュリティ対策に貢献する」という重要な利点を理解しましょう。
  * **接続文字列の安全な管理**
      * **課題:** 現在、データベースの接続文字列は `App.config` ファイルに平文（そのまま読める形式）で保存されています。このファイルが漏洩すると、誰でもデータベースにアクセスできてしまいます。
      * **対策:** 実務では、接続文字列を保護するために以下のような手法が用いられます。どのような技術か調査してみましょう。
          * .NETの構成ファイルの暗号化機能
          * Azure Key VaultやAWS Secrets Managerのようなクラウドのシークレット管理サービス
          * ユーザーシークレット (開発環境用)


## 用語説明
### Entity Framework設定 🔗

#### NuGetパッケージとは
NuGetは.NET開発で使用するライブラリ管理システムです。
他の開発者が作成した便利な機能を、簡単に自分のプロジェクトに追加できます。

#### Entity Frameworkとは
Entity Framework（EF）は、データベース操作を簡単にするためのツールです。
SQLを直接書く代わりに、C#のオブジェクトを操作するだけで
データベースの登録・更新・削除ができるようになります。

#### インストール手順
1. Visual Studioでプロジェクトを右クリック
2. 「NuGetパッケージの管理」を選択
3. 「参照」タブで以下を検索してインストール：
   - EntityFramework（または Microsoft.EntityFrameworkCore）
   - MySql.Data.EntityFramework（または MySql.EntityFrameworkCore）

#### なぜこれらが必要？
- EntityFramework: データベース操作を簡単にする
- MySql.Data.EntityFramework: EntityFrameworkでMySQLを使えるようにする

### **EntityFrameworkとMySql.Data.EntityFrameworkの関係**

#### **EntityFramework（本体）**
- **役割**: データベース操作を簡単にする「フレームワーク」の本体
- **できること**: C#のオブジェクトとデータベースのテーブルを対応させる基本機能
- **できないこと**: どのデータベース（MySQL、SQL Server、PostgreSQLなど）に接続するかは知らない

#### **MySql.Data.EntityFramework（ドライバー/プロバイダー）**
- **役割**: EntityFrameworkがMySQLと「会話」するための「翻訳機」
- **できること**: EntityFrameworkの命令をMySQLが理解できる形に変換
- **必要な理由**: データベースごとに「方言」が違うため

### **分かりやすい例え**

**EntityFramework = 車のエンジン**
**MySql.Data.EntityFramework = ガソリン**

- エンジンだけあってもガソリンがないと動かない
- ガソリンだけあってもエンジンがないと意味がない
- 両方揃って初めて車（アプリケーション）が動く

### **具体的なコード例**

```csharp
// EntityFrameworkが提供する基本的な書き方
var customers = context.Customers.Where(c => c.Name.Contains("田中"));
context.SaveChanges();

// ↓ MySql.Data.EntityFrameworkが裏で以下に変換
// SELECT * FROM customers WHERE name LIKE '%田中%';
// （MySQLの構文）
```

### **他のデータベースを使う場合**

| データベース | 必要なパッケージ |
|-------------|-----------------|
| MySQL | MySql.Data.EntityFramework |
| SQL Server | System.Data.SqlClient（標準で含まれる場合が多い） |
| PostgreSQL | Npgsql.EntityFramework |
| SQLite | System.Data.SQLite.EF6 |

#### なぜ2つのパッケージが必要？

1. **EntityFramework**: データベース操作の「共通言語」
   - どのデータベースでも同じC#コードで操作できる

2. **MySql.Data.EntityFramework**: MySQL専用の「翻訳機」
   - EntityFrameworkの命令をMySQLが理解できる形に変換

この2つが協力することで、MySQLを簡単に操作できるようになります。

**つまり**: EntityFrameworkは「基盤」、MySql.Data.EntityFrameworkは「MySQL対応アダプター」という関係です。両方必要で、役割が異なります。